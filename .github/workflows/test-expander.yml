name: test-expander
on:
  workflow_call:
    inputs:
      haxe:
        required: true
        type: string

jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-13, windows-latest]
        arch: [ 32, 64 ]
        exclude:
          # Remove 32bit variants for Mac
          - os: macos-13
            arch: 32
        include:
          # Add some extra OS specific variables
          - sep: '/'
          - sep: '\'
            os: windows-latest
          - ext: '.dso'
            os: ubuntu-latest
          - ext: '.dylib'
            os: macos-13
          - ext: '.dll'
            os: windows-latest
    name: test ${{ matrix.os }} (${{ matrix.arch }}bit)
    uses: ./.github/workflows/test.yml
    with:
      haxe: ${{ inputs.haxe }}
      arch: ${{ matrix.arch }}
      sep: ${{ matrix.sep }}
      ext: ${{ matrix.ext }}
      os: ${{ matrix.os }}